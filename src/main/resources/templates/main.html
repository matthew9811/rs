<!DOCTYPE HTML>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">
<head th:include="include :: header"></head>
<body class="childrenBody">
<form class="layui-form">
    <blockquote class="layui-elem-quote quoteBox">
        <form class="layui-form">
            <div class="layui-inline">
                <div class="layui-input-inline">
                    <input type="text" class="layui-input searchVal" placeholder="请输入搜索的内容"/>
                </div>
                <a class="layui-btn search_btn layui-btn-radius" data-type="reload">搜索</a>
            </div>
            <div class="col-sm-4">
                <label class="layui-form-label col-sm-3">请选择范围</label>
                <div class="layui-input-inline col-sm-9">
                    <input type="text" class="layui-input" id="test16" placeholder="开始 到 结束">
                </div>
            </div>
        </form>
    </blockquote>

    <table id="newsList" lay-filter="newsList"></table>
    <script type="text/html" id="toolbarDemo">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中行数据</button>
            <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button>
            <button class="layui-btn layui-btn-sm" lay-event="isAll">验证是否全选</button>
        </div>
    </script>
    <!--操作-->
    <script type="text/html" id="newsListBar">
        <a class="layui-btn layui-btn-xs" lay-event="detail">点击选课</a>
    </script>
</form>
<div th:include="include :: footer"></div>
<script>
    $(function(){
    	layui.use(['form','layer','laydate','table','laytpl'],function(){
    	var layer = layui.layer;
    	layer.msg('hello');
        var form = layui.form,
            layer = parent.layer === undefined ? layui.layer : top.layer,
            $ = layui.jquery,
            laydate = layui.laydate,
            laytpl = layui.laytpl,
            table = layui.table;

        //学生重修课程列表
        table.render({
            elem: '#newsList',
            url : ctx + 'test/getList',
            title: '学生成绩表',
            cellMinWidth : 95,
            page : true,
            toolbar: '#toolbarDemo', //开启工具栏
            height : "full-125",
            limit : 10,
            limits : [10,15,20,25],
            id : "newsListTable",
            initSort: {
                field: 'grade', //排序字段，对应 cols 设定的各字段名
                type: 'asc' //排序方式  asc: 升序、desc: 降序、null: 默认排序
            },
            <!--response: {-->
                <!--statusCode: 200 //重新规定成功的状态码为 200，table 组件默认为 0-->
            <!--},-->
            <!--parseData: function(res){ //将原始数据解析成 table 组件所规定的数据-->
                <!--return {-->
                    <!--"code": res.status, //解析接口状态-->
                    <!--"msg": res.message, //解析提示文本-->
                    <!--"count": res.total, //解析数据长度-->
                    <!--"data": res.item //解析数据列表-->
                <!--};-->
            <!--},-->
            cols : [
                [
                    {type: 'checkbox', fixed: 'left'},
                    {field: 'subNo', title: '课程代码', align:"center"},
                    {field: 'subName', title: '课程名称', align:"center"},
                    {field: 'term', title: '历史修读学期', align:'center'},
                    {field: 'grade', title: '历史成绩',  align:'center', edit: 'text'},
                    {title: '选课操作', width:220, templet:'#newsListBar',fixed:"right",align:"center"},
                    {field: 'remark', title: '备注',  align:'center', event: 'setRemark'},
                ]
            ]
        });

        //头工具栏事件
        table.on('toolbar(newsList)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            switch(obj.event){
            case 'getCheckData':
                var data = checkStatus.data;
                layer.alert(JSON.stringify(data));
                break;
            case 'getCheckLength':
                var data = checkStatus.data;
                layer.msg('选中了：'+ data.length + ' 个');
                break;
            case 'isAll':
                layer.msg(checkStatus.isAll ? '全选': '未全选');
                break;
            };
        });

        //监听复选框选择
        table.on('checkbox(newsList)', function(obj){
            console.log(obj.checked); //当前是否选中状态
            console.log(obj.data); //选中行的相关数据
            console.log(obj.type); //如果触发的是全选，则为：all，如果触发的是单选，则为：one
        });

        //监听单元格编辑
        table.on('edit(newsList)', function(obj){ //注：edit是固定事件名，test是table原始容器的属性 lay-filter="对应的值"
            console.log(obj.value); //得到修改后的值
            console.log(obj.field); //当前编辑的字段名
            console.log(obj.data); //所在行的所有相关数据
         });

         //监听点击事件
        table.on('tool(newsList)', function(obj){
            var data = obj.data;
            <!--layer.msg('点击课程：'+ data.subName);-->
            if(obj.event === 'setRemark'){
                layer.prompt({
                      formType: 2,
                      title: '修改课程代码为 ['+ data.subNo +'] 的备注',
                      value: data.subNo
                }, function(value, index){
                      layer.close(index);
                      //这里一般是发送修改的Ajax请求
                      //同步更新表格和缓存对应的值
                      obj.update({
                      sign: value
                      });
                 });
            }else if(obj.event === 'detail'){
                layer.msg('点击课程：'+ data.subName)
            }
        });

        //搜索【此功能需要后台配合，所以暂时没有动态效果演示】
        $(".search_btn").on("click",function(){
            if($(".searchVal").val() != ''){
                table.reload("newsListTable",{
                    page: {
                        curr: 1 //重新从第 1 页开始
                    },
                    where: {
                        key: $(".searchVal").val()  //搜索的关键字
                    }
                })
            }else{
                layer.msg("请输入搜索的内容");
            }
        });

        //日期时间范围选择
        laydate.render({
            elem: '#test16',
            type: 'datetime',
            range: '到',
            format: 'yyyy-MM-dd HH:mm:ss',
            calendar: true,
            done: function(date){
                console.log(date); //得到初始的日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
            }
        });

    })
    })




</script>
</body>
</html>