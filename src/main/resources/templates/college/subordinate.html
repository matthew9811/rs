<!DOCTYPE HTML>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">
<head th:include="include :: header"></head>
<body class="childrenBody">
<form class="layui-form">
    <blockquote class="layui-elem-quote quoteBox">
        <form class="layui-form">
            <div class="layui-inline">
                <div class="layui-input-inline">
                    <input type="text" class="layui-input searchVal" placeholder="请输入搜索的内容"/>
                </div>
                <a class="layui-btn search_btn layui-btn-radius" data-type="reload">搜索</a>
            </div>
            <div class="col-sm-4">
                <label class="layui-form-label col-sm-3">请选择范围</label>
                <div class="layui-input-inline col-sm-9">
                    <input type="text" class="layui-input layer-range-time" id="time" placeholder="开始 到 结束">
                </div>
            </div>
        </form>
    </blockquote>

    <table id="newsList" lay-filter="newsList"></table>
    <!--<script type="text/html" id="toolbarDemo">-->
    <!--<div class="layui-btn-container">-->
    <!--<button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中行数据</button>-->
    <!--<button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button>-->
    <!--<button class="layui-btn layui-btn-sm" lay-event="isAll">验证是否全选</button>-->
    <!--</div>-->
    <!--</script>-->
    <!--操作-->
    <script type="text/html" id="newsListBar">
        <a class="layui-btn layui-btn-xs" lay-event="detail">点击选课</a>
    </script>
</form>
<div th:include="include :: footer"></div>
<script>
    $(function () {
        layui.use(['form', 'layer','table'], function () {
            var layer = layui.layer;
            layer.msg('hello');
            var form = layui.form,
                layer = parent.layer === undefined ? layui.layer : top.layer,
                $ = layui.jquery,
                table = layui.table;

            //学生重修课程列表
            var options = {
                elem: '#newsList',
                url: ctx + 'college/college/subordinateList',
                title: '选择课程表',
                toolbar: '#toolbarDemo',
                id: "newsListTable",
                cols: [
                    [
                        {type: 'checkbox', fixed: 'left'},
                        {field: 'stuNo', title: '学号', align: "center"},
                        {field: 'userName', title: '姓名', align: "center"},
                        {field: 'subClass', title: '班级', align: "center"},
                        {field: 'major', title: '专业', align: "center"},
                        {field: 'institute', title: '开课学院', align: "center"},
                        {field: 'originalSubNo', title: '原课程代码', align: "center"},
                        {field: 'originalSubName', title: '原课程名称', align: "center"},
                        {field: 'originalSubCredit', title: '原学分', align: "center"},
                        {field: 'nowSubNo', title: '现课程代码', align: "center"},
                        {field: 'nowSubName', title: '现课程名称', align: "center"},
                        {field: 'nowSubCredit', title: '现学分', align: "center"},
                        {field: 'subCarryNo', title: '开课编号', align: "center"},
                        {field: 'subClassName', title: '教学班级', align: "center"},
                        {field: 'status', title: '是否审批', align: "center",templet: function (d) {
                                if (d.status =='0'){
                                    return '未审核'
                                }else if(d.status =='1'){
                                    return '开课通过'
                                }else if(d.status =='2'){
                                    return '开课驳回'
                                }else if(d.status =='3'){
                                    return '教务通过'
                                }else if(d.status =='4'){
                                    return '教务驳回'
                                }
                            }},
                    ]
                ]
            };

            $("[data-field='status']").children().each(function(){
                if($(this).text()=='0'){
                    $(this).text("未审批")
                }else if($(this).text()=='1'){
                    $(this).text("开课通过")
                }else if($(this).text()=='2'){
                    $(this).text("开课驳回")
                }else if($(this).text()=='3'){
                    $(this).text("教务通过")
                }else if($(this).text()=='4'){
                    $(this).text("教务驳回")
                }
            })

            $.table.init(options);

            //头工具栏事件
            table.on('toolbar(newsList)', function (obj) {
                var checkStatus = table.checkStatus(obj.config.id);
                switch (obj.event) {
                    case 'getCheckData':
                        var data = checkStatus.data;
                        layer.alert(JSON.stringify(data));
                        break;
                    case 'getCheckLength':
                        var data = checkStatus.data;
                        layer.msg('选中了：' + data.length + ' 个');
                        break;
                    case 'isAll':
                        layer.msg(checkStatus.isAll ? '全选' : '未全选');
                        break;
                }
                ;
            });

            // 监听复选框选择
            // table.on('checkbox(newsList)', function (obj) {
            //     console.log(obj.checked); //当前是否选中状态
            //     console.log(obj.data); //选中行的相关数据
            //     console.log(obj.type); //如果触发的是全选，则为：all，如果触发的是单选，则为：one
            // });

            //监听点击事件
            table.on('tool(newsList)', function (obj) {
                var data = obj.data;
                <!--layer.msg('点击课程：'+ data.subName);-->
                if (obj.event === 'setRemark') {
                    layer.prompt({
                        formType: 2,
                        title: '修改课程代码为 [' + data.subNo + '] 的备注',
                        value: data.subNo
                    }, function (value, index) {
                        layer.close(index);
                        //这里一般是发送修改的Ajax请求
                        //同步更新表格和缓存对应的值
                        obj.update({
                            sign: value
                        });
                    });
                } else if (obj.event === 'detail') {
                    layer.msg('点击课程：' + data.subName)
                }
            });

            //监听单元格编辑
            console.log($.table.edit('newsList'));

            //监听复选框选择
            console.log($.table.checkbox('newsList'));

            //搜索
            $(".search_btn").on("click", function () {
                console.log($('.layer-range-time').val());
                if ($(".searchVal").val() != '') {
                    table.reload("newsListTable", {
                        page: {
                            curr: 1 //重新从第 1 页开始
                        },
                        where: {
                            key: $(".searchVal").val()  //搜索的关键字
                        }
                    })
                } else {
                    layer.msg("请输入搜索的内容");
                }
            });

        })
    })


</script>
</body>
</html>